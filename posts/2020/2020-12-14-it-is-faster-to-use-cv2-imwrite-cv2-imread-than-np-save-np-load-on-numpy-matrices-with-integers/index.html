<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers | Dilawar's Blog</title>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.89.2">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=keywords content="micro-benchmark,numpy,opencv,pyhton">
<link rel=stylesheet type=text/css media=screen href=/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=/css/main.css>
<link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=/css/katex.css crossorigin=anonymous>
<script defer src=/js/katex.js integrity=sha384-PFWG8XW41D5NzhNv5FegM1CUkw9nNLdWug8DuwnUoNEVop9n5frjcnbtsZtxTNjw crossorigin=anonymous></script>
<script defer src=/js/auto-render.js integrity=sha384-EN2q+JG5/3Z8gD7hT5WZqq+W+9wQR4P3IezfuZmGG5RkNXaaaks85seDJO7WkZlY crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<meta property="og:title" content="cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers">
<meta property="og:description" content="In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.
The standard way is numpy.save and numpy.load which works fine. My experience with opencv made me wonder if cv2.imwrite and cv2.imread can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dilawar.github.io/posts/2020/2020-12-14-it-is-faster-to-use-cv2-imwrite-cv2-imread-than-np-save-np-load-on-numpy-matrices-with-integers/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-12-14T00:00:00+00:00">
<meta property="article:modified_time" content="2020-12-14T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers">
<meta name=twitter:description content="In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.
The standard way is numpy.save and numpy.load which works fine. My experience with opencv made me wonder if cv2.imwrite and cv2.imread can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices.">
<meta itemprop=name content="cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers">
<meta itemprop=description content="In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.
The standard way is numpy.save and numpy.load which works fine. My experience with opencv made me wonder if cv2.imwrite and cv2.imread can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices."><meta itemprop=datePublished content="2020-12-14T00:00:00+00:00">
<meta itemprop=dateModified content="2020-12-14T00:00:00+00:00">
<meta itemprop=wordCount content="350">
<meta itemprop=keywords content="micro-benchmark,numpy,opencv,pyhton,">
</head>
<body>
<header>
<div id=titletext>
<h2 id=title><a href=https://dilawar.github.io>Dilawar's Blog</a></h2>
</div>
<div id=title-description>
<p id=subtitle>watch -n 1 /dev/null</p>
<div id=social>
<nav><ul>
<li><a href=https://github.com/dilawar><i title=Github class="icons fab fa-github"></i></a></li>
<li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li>
</ul></nav>
</div>
</div>
<div id=mainmenu>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>All posts</a></li>
<li><a href=/about>About</a></li>
<li><a href=/tags>Tags</a></li>
</ul>
</nav>
</div>
</header>
<main>
<div class=post>
<article>
<div class=post-header>
<div class=meta>
<div class=date>
<span class=day>14</span>
<span class=rest>Dec 2020</span>
</div>
</div>
<div class=matter>
<h1 class=title>cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers</h1>
<p class=post-meta>
<span class=post-meta>
</span>
</p>
</div>
</div>
<div class=markdown>
<p>In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.</p>
<p>The standard way is <code>numpy.save</code> and <code>numpy.load</code> which works fine. My experience with <code>opencv</code> made me wonder if <code>cv2.imwrite</code> and <code>cv2.imread</code> can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices. I do.</p>
<p>Here are some benchmarks using <code>%timeit</code>.</p>
<h2 id=only-saving-matrices>Only saving matrices</h2>
<p>I generate a random matrix of 400 entries and save it to a png file using OpenCV and also using numpy. OpenCV is roughly 3.6 times faster.</p>
<pre tabindex=0><code>In [8]: %timeit cv2.imwrite('/tmp/a.png', np.random.randint(0, 255, (20,20)))                                                                                     
142 µs ± 1.05 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)

In [10]: %timeit np.save('/tmp/a.npy', np.random.randint(0, 255, (20,20)))                                                                                        
517 µs ± 96.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre><p>The trend continues (OpenCV is ever so slightly faster here) for matrices with 900 entries. I did not test with larger matrices.</p>
<pre tabindex=0><code>In [14]: %timeit cv2.imwrite('/tmp/a.png', np.random.randint(0, 255, (30,30))); a = cv2.imread('/tmp/a.png')                                                      
215 µs ± 2.93 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [15]: %timeit np.save('/tmp/a.npy', np.random.randint(0, 255, (30,30))); np.load('/tmp/a.npy')                                                                 
791 µs ± 29.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre><h2 id=saving-and-reading-matrices>Saving and reading matrices</h2>
<p>Reading back into matrices is also faster with OpenCV. Following micro-benchmarks write and read a randomly generated matrix using OpenCV and numpy.</p>
<pre tabindex=0><code>In [12]: %timeit cv2.imwrite('/tmp/a.png', np.random.randint(0, 255, (20,20))); a = cv2.imread('/tmp/a.png')                                                      
192 µs ± 2.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [13]: %timeit np.save('/tmp/a.npy', np.random.randint(0, 255, (20,20))); np.load('/tmp/a.npy')                                                                 
770 µs ± 23.9 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre><p>I guess I&rsquo;ll be using OpenCV to save data whenever I have integer matrices.</p>
<p>I used Python3.6 on OpenSUSE-15.1 server.</p>
</div>
<div class=tags>
<div class=taxosfloating_left>
<p>Categories</p>
</div>
<div class=termsfloating_right>
<p>
<a href=/categories/benchmark/>benchmark</a>
<a href=/categories/linux/>linux</a>
</p>
</div>
<div class=clearit></div>
<div class=tags>
<div class=taxosfloating_left>
<p>Tags</p>
</div>
<div class=termsfloating_right>
<p>
<a href=/tags/micro-benchmark/>micro-benchmark</a>
<a href=/tags/numpy/>numpy</a>
<a href=/tags/opencv/>opencv</a>
<a href=/tags/pyhton/>pyhton</a>
</p>
</div>
<div class=clearit></div>
</div>
</article>
</div>
</main>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-180197482-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script src=/js/dark-mode.js></script>
</body>
</html>