<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers - Dilawar's Blog</title><link rel=icon type=image/png href=icons/icon.png><meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers">
<meta property="og:description" content="In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.
The standard way is numpy.save and numpy.load which works fine. My experience with opencv made me wonder if cv2.imwrite and cv2.imread can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://dilawar.github.io/posts/2020/2020-12-14-it-is-faster-to-use-cv2-imwrite-cv2-imread-than-np-save-np-load-on-numpy-matrices-with-integers/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-12-14T00:00:00+00:00">
<meta property="article:modified_time" content="2020-12-14T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers">
<meta name=twitter:description content="In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.
The standard way is numpy.save and numpy.load which works fine. My experience with opencv made me wonder if cv2.imwrite and cv2.imread can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices.">
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://dilawar.github.iocss/normalize.css>
<link rel=stylesheet type=text/css media=screen href=https://dilawar.github.iocss/main.css>
<link rel=stylesheet type=text/css href=https://dilawar.github.iocss/custom.css>
<link rel=stylesheet type=text/css href=https://dilawar.github.iocss/dark.css media="(prefers-color-scheme: dark)">
<link rel=stylesheet type=text/css href=https://dilawar.github.iocss/custom-dark.css media="(prefers-color-scheme: dark)">
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://dilawar.github.iojs/main.js></script>
<script src=https://dilawar.github.iojs/abc.js></script>
<script src=https://dilawar.github.iojs/xyz.js></script>
<script src=https://code.jquery.com/jquery-3.4.1.js></script>
</head>
<body>
<div class="container wrapper post">
<div class=header>
<base href=https://dilawar.github.io>
<h1 class=site-title><a href=https://dilawar.github.io>Dilawar's Blog</a></h1>
<div class=site-description><h2>watch -n 1 /dev/null</h2><nav class="nav social">
<ul class=flat><a href=https://github.com/dilawar title=Github><i data-feather=github></i></a></ul>
</nav>
</div>
<nav class=nav>
<ul class=flat>
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/posts>All posts</a>
</li>
<li>
<a href=/about>About</a>
</li>
<li>
<a href=/tags>Tags</a>
</li>
</ul>
</nav>
</div>
<div class=post-header>
<h1 class=title>cv2.imwrite/cv2.imread are faster than np.save/np.load on numpy matrices with integers</h1>
<div class=meta>Posted at &mdash; Dec 14, 2020</div>
</div>
<div class=markdown>
<p>In one of the ongoing projects, I generate a lot of small matrices (~1000 entries). These are often written to the disk and read from it. I was trying to optimize this step since this step run in a REST api.</p>
<p>The standard way is <code>numpy.save</code> and <code>numpy.load</code> which works fine. My experience with <code>opencv</code> made me wonder if <code>cv2.imwrite</code> and <code>cv2.imread</code> can be used. The later saves the matrices to png file which works without any loss of data if you have 8 or 16 bit integer values in your matrices. I do.</p>
<p>Here are some benchmarks using <code>%timeit</code>.</p>
<h2 id=only-saving-matrices>Only saving matrices</h2>
<p>I generate a random matrix of 400 entries and save it to a png file using OpenCV and also using numpy. OpenCV is roughly 3.6 times faster.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>In [8]: %timeit cv2.imwrite(&#39;/tmp/a.png&#39;, np.random.randint(0, 255, (20,20)))                                                                                     
142 µs ± 1.05 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)

In [10]: %timeit np.save(&#39;/tmp/a.npy&#39;, np.random.randint(0, 255, (20,20)))                                                                                        
517 µs ± 96.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre></div><p>The trend continues (OpenCV is ever so slightly faster here) for matrices with 900 entries. I did not test with larger matrices.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>In [14]: %timeit cv2.imwrite(&#39;/tmp/a.png&#39;, np.random.randint(0, 255, (30,30))); a = cv2.imread(&#39;/tmp/a.png&#39;)                                                      
215 µs ± 2.93 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [15]: %timeit np.save(&#39;/tmp/a.npy&#39;, np.random.randint(0, 255, (30,30))); np.load(&#39;/tmp/a.npy&#39;)                                                                 
791 µs ± 29.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre></div><h2 id=saving-and-reading-matrices>Saving and reading matrices</h2>
<p>Reading back into matrices is also faster with OpenCV. Following micro-benchmarks write and read a randomly generated matrix using OpenCV and numpy.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>In [12]: %timeit cv2.imwrite(&#39;/tmp/a.png&#39;, np.random.randint(0, 255, (20,20))); a = cv2.imread(&#39;/tmp/a.png&#39;)                                                      
192 µs ± 2.1 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

In [13]: %timeit np.save(&#39;/tmp/a.npy&#39;, np.random.randint(0, 255, (20,20))); np.load(&#39;/tmp/a.npy&#39;)                                                                 
770 µs ± 23.9 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre></div><p>I guess I&rsquo;ll be using OpenCV to save data whenever I have integer matrices.</p>
<p>I used Python3.6 on OpenSUSE-15.1 server.</p>
</div>
<div class=post-tags>
<nav class="nav tags">
<ul class=flat>
<li><a href=/tags/micro-benchmark>micro-benchmark</a></li>
<li><a href=/tags/numpy>numpy</a></li>
<li><a href=/tags/opencv>opencv</a></li>
<li><a href=/tags/pyhton>pyhton</a></li>
</ul>
</nav>
</div>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='dilawarsblog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript>
<a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<div class="footer wrapper">
<nav class=nav>
<div> <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div>
</nav>
</div>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-180197482-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script>feather.replace()</script>
</body>
</html>